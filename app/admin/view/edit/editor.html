
<? include('header.html') ?>

<div id="app_title">
<?=req.url.query.app?>
</div>

<? local file = req.url.query.file ?>
<div id="app_edit_file">
	<?=file?>
</div>

<div id="editor">function foo(items) {
	var x = "All this is syntax highlighted";
	return x;
	}</div>

<? include("http://cdn.staticfile.org/ace/1.1.01/ace.js") ?>
<? include("http://cdn.staticfile.org/ace/1.1.01/mode-luapage.js") ?>
<? include("http://cdn.staticfile.org/ace/1.1.01/mode-lua.js") ?>
<? include("http://cdn.staticfile.org/ace/1.1.01/mode-css.js") ?>
<? include("http://cdn.staticfile.org/ace/1.1.01/theme-monokai.js") ?>

<script>
	var editor = ace.edit("editor");
	editor.setTheme("ace/theme/monokai");

	<?
	local mode = "javascript"
	if file:match("%.lua$") then
		mode = "lua"
	end
	if file:match("%.css$") then
		mode = "css"
	end
	if file:match("%.html$") then
		mode = "luapage"
	end
	?>
	editor.getSession().setMode("ace/mode/<?=mode?>");
	$.get("file", { file: "<?=file?>" }, function(data) {
		editor.getSession().setValue(data)
	})
	.done(function() {
		//alert( "file load success" );
	})
	.fail(function() {
		editor.getSession().setValue("failed to load file")
	});

	editor.commands.addCommand({
		name: 'myCommand',
		bindKey: {win: 'Ctrl-M',  mac: 'Command-M'},
		exec: function(editor) {
			var content = editor.getSession().getValue();
			$.post("save", { file: "<?=file?>", content: content },
			function(data){
				alert("Data Saved: " + data);
			});
		},
		readOnly: true // false if this command should not apply in readOnly mode
	});
</script>

<? include('footer.html') ?>
